<!DOCTYPE html>
<html>
<head>
    <title>Chatbot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');
        @import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css');

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2vw;
            background: url('https://media.istockphoto.com/id/1030479060/photo/dark-green-blackboard.jpg?s=2048x2048&w=is&k=20&c=gnci1dB5x4JoBnUXCj7-Xn5nxeqeBAt9uJoyHBTjUEk=') no-repeat center center/cover;
            color: #075333;
            padding: 3vw;
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: bold;
            font-family: 'Pacifico', cursive;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.3);
        }

        .header img {
            height: clamp(40px, 8vw, 50px);
            width: clamp(40px, 8vw, 50px);
            border-radius: 50%;
        }

        .toggle-dark {
            margin: 2vw auto;
            display: block;
            padding: 1.5vw 3vw;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            border: none;
            border-radius: 8px;
            background-color: #343a40;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-dark:hover {
            background-color: #495057;
        }

        .send-button {
            background-color: rgb(25, 135, 84);
            color: white;
            padding: 1.5vw 3vw;
            margin-left: 1.5vw;
            border: none;
            border-radius: 10px;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            cursor: pointer;
        }

        .send-button:hover {
            background-color: rgb(22, 119, 74);
        }

        .chat-input {
            padding: 1.5vw 2vw;
            border: 1px solid #ccc;
            border-radius: 10px;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            flex-grow: 1;
        }

        .chat-input-container {
            display: flex;
            margin-bottom: clamp(20px, 5vh, 40px);
            padding: 0 2vw;
        }

        .app-container {
            max-width: 90vw;
            margin: 0 auto;
            height: calc(100vh - clamp(100px, 15vh, 130px));
            display: flex;
            flex-direction: column;
        }

        .chat-message-user {
            display: flex;
            justify-content: end;
            align-items: start;
        }

        .chat-message-robot {
            display: flex;
            align-items: start;
        }

        .chat-message-text {
            background-color: #f1f1f1;
            padding: 2vw 3vw;
            border-radius: 10px;
            margin-right: 2vw;
            margin-left: 2vw;
            margin-bottom: 3vw;
            max-width: 70%;
            overflow-x: auto;
        }

        .chat-message-profile {
            width: clamp(40px, 8vw, 50px);
        }

        .chat-messages-container {
            flex-grow: 1;
            margin-top: 3vw;
            overflow-y: scroll;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        pre code {
            display: block;
            padding: 1.5vw;
            border-radius: 5px;
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            white-space: pre-wrap;
            word-break: break-all;
        }

        body.dark-mode {
            background-color: #121212;
            color: #ffffff;
        }

        body.dark-mode .chat-message-text {
            background-color: #1e1e1e;
            color: #ffffff;
        }

        body.dark-mode .chat-input {
            background-color: #2a2a2a;
            color: white;
            border: 1px solid #444;
        }

        body.dark-mode .send-button {
            background-color: #0d6efd;
        }

        body.dark-mode .send-button:hover {
            background-color: #0b5ed7;
        }

        body.dark-mode .toggle-dark {
            background-color: #198754;
            color: white;
        }

        body.dark-mode .toggle-dark:hover {
            background-color: #146c43;
        }

        body.dark-mode pre code {
            background-color: #2d2d2d;
        }

        @media (max-width: 768px) {
            .header {
                padding: 4vw;
                font-size: clamp(1.2rem, 4.5vw, 1.8rem);
            }

            .chat-message-text {
                max-width: 80%;
                padding: 3vw 4vw;
            }

            .chat-input-container {
                padding: 0 3vw;
            }

            .app-container {
                max-width: 95vw;
            }
        }

        @media (max-width: 480px) {
            .header img {
                height: clamp(30px, 10vw, 40px);
                width: clamp(30px, 10vw, 40px);
            }

            .toggle-dark {
                padding: 2vw 4vw;
                font-size: clamp(0.7rem, 3vw, 0.9rem);
            }

            .send-button {
                padding: 2vw 4vw;
                font-size: clamp(0.8rem, 3vw, 0.9rem);
            }

            .chat-input {
                padding: 2vw 3vw;
                font-size: clamp(0.8rem, 3vw, 0.9rem);
            }

            .chat-message-text {
                max-width: 85%;
                margin-bottom: 4vw;
            }

            .chat-message-profile {
                width: clamp(30px, 10vw, 40px);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://media.istockphoto.com/id/1430247885/photo/isolated-shot-of-jack-o-lantern-on-black-background.jpg?s=612x612&w=is&k=20&c=b-S5i_zPjlgKHsb1GvZQEddASmNrGNU2K9TIYSB4XPQ="
            alt="Logo">
        LEYTHAN-X's Nexus
    </div>
    <button id="toggle-dark-mode" class="toggle-dark">ðŸŒ™ Toggle Dark Mode</button>
    <div class="js-container"></div>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toggleBtn = document.getElementById('toggle-dark-mode');
            toggleBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
            });
        });
    </script>
    <script type="text/babel">
        function ChatInput({ chatMessages, setChatMessages, setIsTyping }) {
            const [inputText, setInputText] = React.useState('');
            const GEMINI_API_KEY = 'AIzaSyB9a6PBNlh6i-MnUG2Y8T1svbKQALeSsAc'; // Replace with your actual Gemini API key
            const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent';

            function saveInputText(event) {
                setInputText(event.target.value);
            }

            async function sendMessage() {
                if (inputText.trim() === '') return;

                const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const newChatMessages = [
                    ...chatMessages,
                    {
                        message: inputText,
                        sender: 'user',
                        id: crypto.randomUUID(),
                        timestamp: time
                    }
                ];
                setChatMessages(newChatMessages);
                setIsTyping(true);

                try {
                    const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `If the response contains code, format it in a markdown code block with the appropriate language identifier (e.g., \`\`\`javascript or \`\`\`python). Ensure the code is well-structured and properly indented. For non-code responses, provide clear and concise text. Query: ${inputText}`
                                }]
                            }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch response from Gemini API');
                    }

                    const data = await response.json();
                    let botResponse = data.candidates[0].content.parts[0].text;

                    const time2 = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    setChatMessages([
                        ...newChatMessages,
                        {
                            message: botResponse,
                            sender: 'robot',
                            id: crypto.randomUUID(),
                            timestamp: time2,
                            isCode: botResponse.includes('```')
                        }
                    ]);
                } catch (error) {
                    console.error('Error:', error);
                    const time2 = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    setChatMessages([
                        ...newChatMessages,
                        {
                            message: 'Sorry, something went wrong. Please try again.',
                            sender: 'robot',
                            id: crypto.randomUUID(),
                            timestamp: time2,
                            isCode: false
                        }
                    ]);
                } finally {
                    setIsTyping(false);
                }

                setInputText('');
            }

            function handleKeyPress(event) {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            }

            return (
                <div className="chat-input-container">
                    <input
                        placeholder="Send a message to Chatbot"
                        onChange={saveInputText}
                        onKeyPress={handleKeyPress}
                        value={inputText}
                        className="chat-input"
                    />
                    <button onClick={sendMessage} className="send-button">Send</button>
                </div>
            );
        }

        function ChatMessage({ message, sender, timestamp, isCode }) {
            const renderMessage = () => {
                if (isCode) {
                    const codeMatch = message.match(/```(\w+)?\n([\s\S]*?)\n```/);
                    if (codeMatch) {
                        const language = codeMatch[1] || 'text';
                        const codeContent = codeMatch[2];
                        return (
                            <pre>
                                <code className={`language-${language}`}>
                                    {codeContent}
                                </code>
                            </pre>
                        );
                    }
                }
                return <div>{message}</div>;
            };

            return (
                <div className={sender === 'user' ? 'chat-message-user' : 'chat-message-robot'}>
                    {sender === 'robot' && (
                        <img src="robot.png" className="chat-message-profile" alt="Robot" />
                    )}
                    <div className="chat-message-text">
                        {renderMessage()}
                        <div style={{ fontSize: '10px', marginTop: '5px', textAlign: 'right', opacity: 0.6 }}>
                            {timestamp}
                        </div>
                    </div>
                    {sender === 'user' && (
                        <img src="user.png" className="chat-message-profile" alt="User" />
                    )}
                </div>
            );
        }

        function ChatMessages({ chatMessages }) {
            const chatMessagesRef = React.useRef(null);
            React.useEffect(() => {
                const containerElem = chatMessagesRef.current;
                if (containerElem) {
                    containerElem.scrollTop = containerElem.scrollHeight;
                }
                Prism.highlightAll();
            }, [chatMessages]);

            return (
                <div className="chat-messages-container" ref={chatMessagesRef}>
                    {chatMessages.map((chatMessage) => (
                        <ChatMessage
                            message={chatMessage.message}
                            sender={chatMessage.sender}
                            timestamp={chatMessage.timestamp}
                            isCode={chatMessage.isCode || false}
                            key={chatMessage.id}
                        />
                    ))}
                </div>
            );
        }

        function App() {
            const [chatMessages, setChatMessages] = React.useState([
                {
                    message: "hello chatbot",
                    sender: "user",
                    id: 'id1',
                    timestamp: "10:00",
                    isCode: false
                },
                {
                    message: "Hello! How can I help you?",
                    sender: "robot",
                    id: 'id2',
                    timestamp: "10:00",
                    isCode: false
                }
            ]);
            const [isTyping, setIsTyping] = React.useState(false);

            return (
                <div className="app-container">
                    <ChatMessages chatMessages={chatMessages} />
                    {isTyping && (
                        <div style={{ paddingLeft: '10px', fontStyle: 'italic', color: 'gray' }}>
                            Chatbot is typing...
                        </div>
                    )}
                    <ChatInput
                        chatMessages={chatMessages}
                        setChatMessages={setChatMessages}
                        setIsTyping={setIsTyping}
                    />
                </div>
            );
        }

        const container = document.querySelector('.js-container');
        ReactDOM.createRoot(container).render(<App />);
    </script>
</body>
</html>